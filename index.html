<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة المستشفيات - تجمع عسير الصحي</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --moh-green: #007e3a;
            --moh-light-green: #e0f2e6;
            --moh-dark-green: #00612d;
            --moh-gold: #d4af37;
            --moh-white: #ffffff;
            --moh-light-gray: #f5f5f5;
            --moh-text: #333333;
        }
        
        body {
            background-color: var(--moh-light-gray);
            color: var(--moh-text);
            min-height: 100vh;
            padding: 15px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, var(--moh-green), var(--moh-dark-green));
            color: var(--moh-white);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            text-align: center;
            animation: fadeIn 1s ease;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .logo {
            width: 70px;
            height: 70px;
            background-color: var(--moh-white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: var(--moh-green);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        p.subtitle {
            font-size: 1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 992px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .logo {
                width: 60px;
                height: 60px;
                font-size: 25px;
            }
        }
        
        .card {
            background: var(--moh-white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--moh-green), var(--moh-dark-green));
            color: var(--moh-white);
            padding: 15px 20px;
            font-size: 1.1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-body {
            padding: 20px;
            height: 400px;
        }
        
        .map-container {
            height: 100%;
        }
        
        #hospitals-map {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            z-index: 1;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--moh-green), var(--moh-dark-green));
            color: var(--moh-white);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
        }
        
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.2);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
            transition: all 0.5s ease;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .controls {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            background: var(--moh-green);
            border: none;
            color: var(--moh-white);
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        button:hover {
            background: var(--moh-dark-green);
            transform: translateY(-2px);
        }
        
        .data-section {
            margin-top: 25px;
            animation: fadeIn 1.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        select, input {
            padding: 10px 12px;
            border-radius: 6px;
            border: 1px solid #ddd;
            min-width: 150px;
            flex: 1;
            background-color: var(--moh-white);
            font-size: 0.9rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        select:focus, input:focus {
            border-color: var(--moh-green);
            box-shadow: 0 0 0 2px rgba(0, 126, 58, 0.2);
            outline: none;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--moh-white);
            min-width: 800px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9rem;
        }
        
        th {
            background: linear-gradient(135deg, var(--moh-green), var(--moh-dark-green));
            color: var(--moh-white);
            font-weight: bold;
            position: sticky;
            top: 0;
        }
        
        tr {
            transition: background-color 0.3s;
        }
        
        tr:hover {
            background-color: var(--moh-light-green);
        }
        
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            color: var(--moh-green);
            font-size: 0.9rem;
            animation: fadeIn 2s ease;
        }
        
        .hospital-marker {
            background: var(--moh-green);
            color: var(--moh-white);
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .legend {
            background: var(--moh-white);
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.15);
            font-size: 0.8rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-left: 8px;
        }
        
        /* تحسينات للهاتف */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            header {
                padding: 15px;
            }
            
            .card-body {
                padding: 15px;
                height: 350px;
            }
            
            .filters {
                flex-direction: column;
                gap: 10px;
            }
            
            select, input {
                min-width: 100%;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .controls {
                justify-content: center;
            }
            
            button {
                flex: 1;
                justify-content: center;
            }
            
            th, td {
                padding: 10px 12px;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.3rem;
            }
            
            .card-header {
                font-size: 1rem;
                padding: 12px 15px;
            }
            
            .stat-number {
                font-size: 1.5rem;
            }
            
            .logo {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }
        
        /* شريط التمرير المخصص */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--moh-green);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--moh-dark-green);
        }
        
        /* نافذة التفاصيل */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background-color: var(--moh-white);
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            animation: scaleIn 0.3s ease;
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--moh-light-green);
        }
        
        .modal-title {
            font-size: 1.4rem;
            color: var(--moh-green);
            font-weight: bold;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--moh-text);
            transition: color 0.3s;
        }
        
        .close-btn:hover {
            color: var(--moh-dark-green);
        }
        
        .detail-item {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }
        
        .detail-label {
            font-weight: bold;
            min-width: 120px;
            color: var(--moh-dark-green);
        }
        
        .detail-value {
            flex: 1;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 10px 15px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background-color: var(--moh-green);
            color: var(--moh-white);
        }
        
        .btn-secondary {
            background-color: var(--moh-gold);
            color: var(--moh-text);
        }
        
        .closest-hospital {
            background-color: var(--moh-light-green);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-right: 4px solid var(--moh-green);
            animation: fadeIn 0.5s ease;
        }
        
        .closest-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--moh-dark-green);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .counter {
            font-variant-numeric: tabular-nums;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 126, 58, 0.3);
            border-radius: 50%;
            border-top-color: var(--moh-green);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: var(--moh-green);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        /* تلميحات عند التمرير */
        .tooltip {
            position: relative;
            cursor: pointer;
        }
        
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--moh-dark-green);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            z-index: 100;
        }
        
        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        /* تأثيرات للجدول */
        .hospital-row {
            transition: all 0.3s ease;
        }
        
        .hospital-row:hover {
            transform: scale(1.01);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* تأثيرات للبطاقات الإحصائية */
        .stats-container {
            perspective: 1000px;
        }
        
        .stat-card {
            transform-style: preserve-3d;
        }
        
        .stat-card:hover {
            transform: translateY(-5px) rotateX(5deg);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <div class="logo">
                    <i class="fas fa-hospital"></i>
                </div>
                <div>
                    <h1>نظام إدارة المستشفيات - تجمع عسير الصحي</h1>
                    <p class="subtitle">منصة متكاملة لعرض بيانات المستشفيات والمراكز الصحية في منطقة عسير</p>
                </div>
            </div>
        </header>
        
        <div class="dashboard">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-map-marked-alt"></i>
                    <span>الخريطة التفاعلية للمستشفيات</span>
                </div>
                <div class="card-body">
                    <div class="map-container">
                        <div id="hospitals-map"></div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-chart-bar"></i>
                    <span>إحصائيات عامة</span>
                </div>
                <div class="card-body">
                    <div class="stats-container">
                        <div class="stat-card" id="total-hospitals" data-tooltip="إجمالي عدد المستشفيات في النظام">
                            <div class="stat-icon">
                                <i class="fas fa-hospital"></i>
                            </div>
                            <div class="stat-number counter">0</div>
                            <div class="stat-label">عدد المستشفيات</div>
                        </div>
                        <div class="stat-card" id="total-beds" data-tooltip="إجمالي عدد أسرة المستشفيات">
                            <div class="stat-icon">
                                <i class="fas fa-bed"></i>
                            </div>
                            <div class="stat-number counter">0</div>
                            <div class="stat-label">إجمالي الأسرة</div>
                        </div>
                        <div class="stat-card" id="total-icu" data-tooltip="إجمالي عدد أسرة العناية المركزة">
                            <div class="stat-icon">
                                <i class="fas fa-procedures"></i>
                            </div>
                            <div class="stat-number counter">0</div>
                            <div class="stat-label">أسرة العناية المركزة</div>
                        </div>
                        <div class="stat-card" id="private-hospitals" data-tooltip="عدد المستشفيات الخاصة">
                            <div class="stat-icon">
                                <i class="fas fa-stethoscope"></i>
                            </div>
                            <div class="stat-number counter">0</div>
                            <div class="stat-label">مستشفى خاص</div>
                        </div>
                        <div class="stat-card" id="general-hospitals" data-tooltip="عدد المستشفيات العامة">
                            <div class="stat-icon">
                                <i class="fas fa-clinic-medical"></i>
                            </div>
                            <div class="stat-number counter">0</div>
                            <div class="stat-label">مستشفى عام</div>
                        </div>
                        <div class="stat-card" id="specialized-hospitals" data-tooltip="عدد المستشفيات المتخصصة">
                            <div class="stat-icon">
                                <i class="fas fa-heartbeat"></i>
                            </div>
                            <div class="stat-number counter">0</div>
                            <div class="stat-label">مستشفى متخصص</div>
                        </div>
                    </div>
                    
                    <div class="controls">
                        <button id="zoom-in" class="tooltip" data-tooltip="تكبير الخريطة">
                            <i class="fas fa-search-plus"></i>
                            تكبير
                        </button>
                        <button id="zoom-out" class="tooltip" data-tooltip="تصغير الخريطة">
                            <i class="fas fa-search-minus"></i>
                            تصغير
                        </button>
                        <button id="reset-view" class="tooltip" data-tooltip="إعادة تعيين الخريطة">
                            <i class="fas fa-globe"></i>
                            عرض الكل
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="data-section">
            <div class="filters">
                <select id="filter-type" class="tooltip" data-tooltip="تصفية حسب نوع المستشفى">
                    <option value="">جميع الأنواع</option>
                    <option value="عام">مستشفيات عامة</option>
                    <option value="مركزية">مستشفيات مركزية</option>
                    <option value="متخصصة">مستشفيات متخصصة</option>
                    <option value="خاص">مستشفى خاص</option>
                </select>
                
                <select id="filter-supervisor" class="tooltip" data-tooltip="تصفية حسب الجهة المشرفة">
                    <option value="">جميع الجهات المشرفة</option>
                    <option value="التجمع الصحي بعسير">التجمع الصحي بعسير</option>
                    <option value="تجمع عسير الصحي">تجمع عسير الصحي</option>
                    <option value="القطاع الخاص">القطاع الخاص</option>
                </select>
                
                <input type="text" id="search-input" placeholder="ابحث باسم المستشفى أو المحافظة..." class="tooltip" data-tooltip="ابحث في جميع بيانات المستشفيات">
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>اسم المستشفى</th>
                            <th>المحافظة</th>
                            <th>النوع</th>
                            <th>الجهة المشرفة</th>
                            <th>عدد الأسرة</th>
                            <th>أسرة العناية</th>
                            <th>أقرب مستشفى</th>
                            <th>التفاصيل</th>
                        </tr>
                    </thead>
                    <tbody id="hospitals-table">
                        <!-- سيتم ملؤها بواسطة JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <footer>
            <p>© 2023 وزارة الصحة - المملكة العربية السعودية. جميع الحقوق محفوظة.</p>
        </footer>
    </div>

    <!-- نافذة التفاصيل -->
    <div class="modal" id="details-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-hospital-name">اسم المستشفى</h2>
                <button class="close-btn" id="close-modal">&times;</button>
            </div>
            <div id="modal-content-body">
                <!-- سيتم ملؤها بواسطة JavaScript -->
            </div>
        </div>
    </div>

    <!-- إشعار -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-text"></span>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // بيانات المستشفيات من الملف المرفق مع الروابط الصحيحة
        const hospitals = [
            {id: 1, name: "مستشفى عسير المركزي", city: "مدينة أبها", supervisor: "التجمع الصحي بعسير", type: "مركزية", beds: 408, icu: 50, lat: 18.2195, lng: 42.535, googleMaps: "https://maps.app.goo.gl/itDwkiPRgRT9LNxy6"},
            {id: 2, name: "مستشفى الملك عبدالله", city: "محافظة بيشة", supervisor: "التجمع الصحي بعسير", type: "عام", beds: 360, icu: 30, lat: 18.2393, lng: 42.4967, googleMaps: "https://www.google.com/maps/search/?api=1&query=18.2393,42.4967"},
            {id: 3, name: "مستشفى ابها للولادة والأطفال", city: "مدينة أبها", supervisor: "التجمع الصحي بعسير", type: "متخصصة", beds: 212, icu: 4, lat: 18.2163, lng: 42.5516, googleMaps: "https://www.google.com/maps/search/?api=1&query=18.2163,42.5516"},
            {id: 4, name: "خميس مشيط للولادة والأطفال", city: "محافظة خميس مشيط", supervisor: "التجمع الصحي بعسير", type: "متخصصة", beds: 200, icu: 0, lat: 18.2985, lng: 42.7554, googleMaps: "https://maps.app.goo.gl/PMt7oGTEPPVp1HS47"},
            {id: 5, name: "مستشفى محaيل العام", city: "عسير", supervisor: "تجمع عسير الصحي", type: "عام", beds: 170, icu: 10, lat: 18.5583, lng: 42.0621, googleMaps: "https://www.google.com/maps/search/?api=1&query=18.5583,42.0621"},
            {id: 6, name: "خميس مشيط العام", city: "محافظة خmيس مشيط", supervisor: "التجمع الصحي بعسير", type: "عام", beds: 150, icu: 15, lat: 18.2838, lng: 42.7483, googleMaps: "https://www.google.com/maps/search/?api=1&query=18.2838,42.7483"},
            {id: 7, name: "مستشفى سراة عبيدة العام", city: "محافظة سراة عبيدة", supervisor: "التجمع الصحي بعسير", type: "عام", beds: 110, icu: 5, lat: 18.0645, lng: 43.1539, googleMaps: "https://maps.app.goo.gl/N5i17V1uEYdo3ZVW8"},
            {id: 8, name: "مستشفى إرادة والصحة النفسية بأبها", city: "مدينة أبها", supervisor: "التجمع الصحي بعسير", type: "متخصصة", beds: 100, icu: 0, lat: 18.2045, lng: 42.5029, googleMaps: "https://www.google.com/maps/search/?api=1&query=18.2045,42.5029"},
            {id: 9, name: "مستشفى الولادة والأطفال بيشة", city: "محافظة بيشة", supervisor: "التجمع الصحي بعسير", type: "متخصصة", beds: 100, icu: 6, lat: 20.0152, lng: 42.6186, googleMaps: "https://maps.app.goo.gl/LH8XgWrEwTuPqQvx6"},
            {id: 10, name: "مستشفى أحد رفيدة العام", city: "محافظة أحد رفيدة", supervisor: "التجمع الصحي بعسير", type: "عام", beds: 100, icu: 10, lat: 18.1725, lng: 42.8251, googleMaps: "https://maps.app.goo.gl/UPRutRfUat1wHzwc9"},
            {id: 30, name: "المستشفى السعودي الألماني", city: "خميس مشيط", supervisor: "القطاع الخاص", type: "خاص", beds: 400, icu: 52, lat: 18.2527, lng: 42.5624, googleMaps: "https://www.google.com/maps/search/?api=1&query=18.2527,42.5624"},
            {id: 31, name: "مستشفى الحياة الوطني - خميس مشيط", city: "محافظة خميس مشيط", supervisor: "القطاع الخاص", type: "خاص", beds: 200, icu: 30, lat: 18.2917, lng: 42.748, googleMaps: "https://www.google.com/maps/search/?api=1&query=18.2917,42.748"},
            {id: 32, name: "مستشفى أبها الخاص", city: "مدينة أبها", supervisor: "القطاع الخاص", type: "خاص", beds: 200, icu: 46, lat: 18.2327, lng: 42.4984, googleMaps: "https://maps.app.goo.gl/YSyE5aXVokwQefEH9"},
            {id: 33, name: "الحياة الوطني أبها", city: "مدينة أبها", supervisor: "القطاع الخاص", type: "خاص", beds: 200, icu: 40, lat: 18.2384, lng: 42.5678, googleMaps: "https://www.google.com/maps/search/?api=1&query=18.2384,42.5678"}
        ];

        // حساب الإحصائيات
        function calculateStats() {
            let totalBeds = 0;
            let totalIcu = 0;
            let privateCount = 0;
            let generalCount = 0;
            let specializedCount = 0;
            
            hospitals.forEach(hospital => {
                totalBeds += hospital.beds;
                totalIcu += hospital.icu;
                
                if (hospital.type === "خاص") privateCount++;
                else if (hospital.type === "عام") generalCount++;
                else if (hospital.type === "متخصصة" || hospital.type === "مركزية") specializedCount++;
            });
            
            return {
                total: hospitals.length,
                totalBeds,
                totalIcu,
                privateCount,
                generalCount,
                specializedCount
            };
        }

        // عرض الإحصائيات مع تأثير العد
        function animateValue(element, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                element.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString();
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        function updateStats() {
            const stats = calculateStats();
            
            animateValue(document.getElementById('total-hospitals').querySelector('.stat-number'), 0, stats.total, 2000);
            animateValue(document.getElementById('total-beds').querySelector('.stat-number'), 0, stats.totalBeds, 2000);
            animateValue(document.getElementById('total-icu').querySelector('.stat-number'), 0, stats.totalIcu, 2000);
            animateValue(document.getElementById('private-hospitals').querySelector('.stat-number'), 0, stats.privateCount, 2000);
            animateValue(document.getElementById('general-hospitals').querySelector('.stat-number'), 0, stats.generalCount, 2000);
            animateValue(document.getElementById('specialized-hospitals').querySelector('.stat-number'), 0, stats.specializedCount, 2000);
        }

        // إظهار الإشعار
        function showNotification(message) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            notificationText.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // حساب المسافة بين نقطتين باستخدام Haversine formula
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // نصف قطر الأرض بالكيلومتر
            const dLat = deg2rad(lat2 - lat1);
            const dLon = deg2rad(lon2 - lon1);
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
                Math.sin(dLon/2) * Math.sin(dLon/2); 
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
            const distance = R * c; // المسافة بالكيلومتر
            return distance;
        }

        function deg2rad(deg) {
            return deg * (Math.PI/180);
        }

        // إيجاد أقرب مستشفى لكل مستشفى
        function findClosestHospitals() {
            hospitals.forEach(hospital => {
                let closestDistance = Infinity;
                let closestHospital = null;
                
                hospitals.forEach(otherHospital => {
                    if (hospital.id !== otherHospital.id) {
                        const distance = calculateDistance(
                            hospital.lat, hospital.lng,
                            otherHospital.lat, otherHospital.lng
                        );
                        
                        if (distance < closestDistance) {
                            closestDistance = distance;
                            closestHospital = otherHospital;
                        }
                    }
                });
                
                hospital.closest = closestHospital;
                hospital.closestDistance = closestDistance.toFixed(1);
            });
        }

        // تهيئة الخريطة
        const map = L.map('hospitals-map').setView([18.5, 42.5], 8);
        
        // إضافة طبقة الخريطة
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 18
        }).addTo(map);
        
        // إضافة علامات للمستشفيات
        hospitals.forEach(hospital => {
            let color;
            if (hospital.type === "خاص") color = '#d4af37'; // ذهبي
            else if (hospital.type === "مركزية") color = '#007e3a'; // أخضر
            else if (hospital.type === "متخصصة") color = '#1a2a6c'; // أزرق داكن
            else color = '#17a2b8'; // أزرق فاتح
            
            const marker = L.marker([hospital.lat, hospital.lng])
                .addTo(map)
                .bindPopup(`
                    <div style="text-align: right; direction: rtl; font-family: Tahoma, sans-serif;">
                        <h3 style="margin: 0 0 10px; color: ${color}; border-bottom: 2px solid ${color}; padding-bottom: 5px;">${hospital.name}</h3>
                        <p style="margin: 8px 0;"><strong>المحافظة:</strong> ${hospital.city}</p>
                        <p style="margin: 8px 0;"><strong>النوع:</strong> ${hospital.type}</p>
                        <p style="margin: 8px 0;"><strong>الجهة المشرفة:</strong> ${hospital.supervisor}</p>
                        <p style="margin: 8px 0;"><strong>عدد الأسرة:</strong> ${hospital.beds}</p>
                        <p style="margin: 8px 0;"><strong>أسرة العناية المركزة:</strong> ${hospital.icu}</p>
                    </div>
                `);
            
            // تخصيص مظهر العلامة
            marker.setIcon(
                L.divIcon({
                    className: 'hospital-marker',
                    html: `<i class="fas fa-hospital" style="font-size: 16px;"></i>`,
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                })
            );
        });
        
        // ملء الجدول بالبيانات
        const tableBody = document.getElementById('hospitals-table');
        
        function populateTable(data) {
            tableBody.innerHTML = '';
            if (data.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="9" style="text-align: center; padding: 20px; color: #777;">لا توجد نتائج مطابقة لبحثك</td>`;
                tableBody.appendChild(row);
                return;
            }
            
            data.forEach(hospital => {
                const row = document.createElement('tr');
                row.className = 'hospital-row';
                row.innerHTML = `
                    <td>${hospital.id}</td>
                    <td>${hospital.name}</td>
                    <td>${hospital.city}</td>
                    <td>${hospital.type}</td>
                    <td>${hospital.supervisor}</td>
                    <td>${hospital.beds}</td>
                    <td>${hospital.icu}</td>
                    <td>${hospital.closest ? `${hospital.closest.name} (${hospital.closestDistance} كم)` : 'غير متوفر'}</td>
                    <td>
                        <button onclick="showDetails(${hospital.id})" style="padding: 5px 10px;" class="tooltip" data-tooltip="عرض التفاصيل الكاملة">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // إضافة أحداث لأزرار التحكم
        document.getElementById('zoom-in').addEventListener('click', () => {
            map.zoomIn();
            showNotification("تم تكبير الخريطة");
        });
        
        document.getElementById('zoom-out').addEventListener('click', () => {
            map.zoomOut();
            showNotification("تم تصغير الخريطة");
        });
        
        document.getElementById('reset-view').addEventListener('click', () => {
            map.setView([18.5, 42.5], 8);
            showNotification("تم إعادة تعيين عرض الخريطة");
        });
        
        // وظائف التصفية والبحث
        document.getElementById('filter-type').addEventListener('change', filterTable);
        document.getElementById('filter-supervisor').addEventListener('change', filterTable);
        document.getElementById('search-input').addEventListener('input', filterTable);
        
        function filterTable() {
            const typeFilter = document.getElementById('filter-type').value;
            const supervisorFilter = document.getElementById('filter-supervisor').value;
            const searchText = document.getElementById('search-input').value.toLowerCase();
            
            const filteredData = hospitals.filter(hospital => {
                return (typeFilter === '' || hospital.type === typeFilter) &&
                       (supervisorFilter === '' || hospital.supervisor === supervisorFilter) &&
                       (hospital.name.toLowerCase().includes(searchText) || 
                        hospital.city.toLowerCase().includes(searchText) ||
                        hospital.supervisor.toLowerCase().includes(searchText) ||
                        hospital.type.toLowerCase().includes(searchText));
            });
            
            populateTable(filteredData);
            
            if (searchText) {
                showNotification(`تم العثور على ${filteredData.length} نتيجة للبحث`);
            }
        }
        
        // وظيفة لعرض التفاصيل في النافذة المنبثقة
        function showDetails(id) {
            const hospital = hospitals.find(h => h.id === id);
            if (hospital) {
                document.getElementById('modal-hospital-name').textContent = hospital.name;
                
                let modalContent = `
                    <div class="detail-item">
                        <span class="detail-label">المحافظة:</span>
                        <span class="detail-value">${hospital.city}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">النوع:</span>
                        <span class="detail-value">${hospital.type}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">الجهة المشرفة:</span>
                        <span class="detail-value">${hospital.supervisor}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">عدد الأسرة:</span>
                        <span class="detail-value">${hospital.beds}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">أسرة العناية المركزة:</span>
                        <span class="detail-value">${hospital.icu}</span>
                    </div>
                `;
                
                if (hospital.closest) {
                    modalContent += `
                        <div class="closest-hospital">
                            <div class="closest-title">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>أقرب مستشفى</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">اسم المستشفى:</span>
                                <span class="detail-value">${hospital.closest.name}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">المسافة:</span>
                                <span class="detail-value">${hospital.closestDistance} كيلومتر</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">النوع:</span>
                                <span class="detail-value">${hospital.closest.type}</span>
                            </div>
                        </div>
                    `;
                }
                
                modalContent += `
                    <div class="action-buttons">
                        <a href="${hospital.googleMaps}" target="_blank" class="action-btn btn-primary">
                            <i class="fas fa-map-marked-alt"></i>
                            الانتقال إلى الموقع
                        </a>
                        <button onclick="closeModal()" class="action-btn btn-secondary">
                            <i class="fas fa-times"></i>
                            إغلاق
                        </button>
                    </div>
                `;
                
                document.getElementById('modal-content-body').innerHTML = modalContent;
                document.getElementById('details-modal').style.display = 'flex';
            }
        }
        
        // إغلاق النافذة المنبثقة
        function closeModal() {
            document.getElementById('details-modal').style.display = 'none';
        }
        
        document.getElementById('close-modal').addEventListener('click', closeModal);
        
        // إضافة وسيلة إيضاح للخريطة
        const legend = L.control({ position: 'bottomright' });
        legend.onAdd = function (map) {
            const div = L.DomUtil.create('div', 'legend');
            div.innerHTML = `
                <h4 style="margin-bottom: 10px; text-align: center; color: var(--moh-green);">وسيلة الإيضاح</h4>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #007e3a;"></div>
                    <span>مستشفيات مركزية</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #17a2b8;"></div>
                    <span>مستشفيات عامة</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #1a2a6c;"></div>
                    <span>مستشفيات متخصصة</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #d4af37;"></div>
                    <span>مستشفيات خاصة</span>
                </div>
            `;
            return div;
        };
        legend.addTo(map);
        
        // حساب أقرب المستشفيات عند تحميل الصفحة
        findClosestHospitals();
        populateTable(hospitals);
        
        // تحديث الإحصائيات بعد تحميل الصفحة
        setTimeout(updateStats, 500);
        
        // إضافة تأثيرات عند التمرير
        window.addEventListener('scroll', () => {
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                const cardPosition = card.getBoundingClientRect().top;
                const screenPosition = window.innerHeight / 1.3;
                if (cardPosition < screenPosition) {
                    card.style.opacity = 1;
                    card.style.transform = 'translateY(0)';
                }
            });
        });
    </script>
</body>
</html>
